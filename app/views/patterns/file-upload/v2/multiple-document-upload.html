{% extends "_layouts/layout-casework.html" %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <span class="govuk-caption-l">Appeal 12345678</span>
    <h1 class="govuk-heading-l">Upload cross-team correspondence</h1>

    <p>
      Each file must be a PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, MSG, JPG, JPEG, MPEG, MP3, MP4, MOV, PNG, TIF or TIFF
      and smaller than 250MB.
    </p>
    <p>
      The total size of your uploaded files must be smaller than 1GB.
    </p>

    <h2 class="govuk-heading-m">Upload files</h2>

    <!-- Dashed box upload area -->
    <div class="moj-multi-file-upload__upload"
      style="border: 2px dashed #b1b4b6;padding-left: 16px; padding-top: 60px; padding-bottom: 60px; align-items: center; background-color: #ffffff; margin-bottom: 30px; display: flex;">
      <div class="govuk-form-group" style="margin-bottom: 0; display: flex; align-items: center;">
        <label class="govuk-button govuk-button--secondary" for="documents" style="margin-bottom: 0; cursor: pointer;">
          Choose files
        </label>
        <p class="govuk-body" style="margin: 0; margin-left: 10px;">or drop files</p>
        <input
          class="govuk-file-upload moj-multi-file-upload__input"
          id="documents"
          name="documents"
          type="file"
          multiple
          style="position: absolute; left: -9999px;">
      </div>
    </div>
    <!-- End dashed box upload area -->

    <table class="govuk-table" id="filesTable">
      <colgroup>
        <col style="width: 30%;">
        <col style="width: 45%;">
        <col style="width: 5%;">
      </colgroup>

      <tbody class="govuk-table__body">
      </tbody>
    </table>

    <form action="/projects/file-upload/v4/manage-documents/file-uploading" method="post">
      <button
        type="submit"
        class="govuk-button"
        data-module="govuk-button"
        id="continue-button">
        Continue
      </button>
    </form>

  </div>
</div>

<script>
  const fileInput = document.getElementById('documents');
  const uploadArea = document.querySelector('.moj-multi-file-upload__upload');
  const tableBody = document.querySelector('#filesTable tbody');

  // Handle file selection
  fileInput.addEventListener('change', function (e) {
    const files = Array.from(e.target.files);
    
    if (files.length === 0) {
      return;
    }

    // Add rows for each selected file
    files.forEach((file, index) => {
      const row = document.createElement('tr');
      row.className = 'govuk-table__row uploading-row';
      row.dataset.file = file.name;

      row.innerHTML = `
        <td class="govuk-table__cell">
          ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)
        </td>
        <td class="govuk-table__cell">
          Uploading: <span class="progress-percent">0%</span>
        </td>
        <td class="govuk-table__cell">
          <a href="#" class="govuk-link">Cancel</a>
        </td>
      `;

      tableBody.appendChild(row);

      // Trigger animation for this row
      animateUpload(row, index);
    });

    // Clear the input so the same files can be selected again
    fileInput.value = '';
  });

  // Handle drag and drop
  uploadArea.addEventListener('dragover', function (e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#0b0c0c';
    uploadArea.style.backgroundColor = '#f8f8f8';
  });

  uploadArea.addEventListener('dragleave', function (e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#b1b4b6';
    uploadArea.style.backgroundColor = '#ffffff';
  });

  uploadArea.addEventListener('drop', function (e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#b1b4b6';
    uploadArea.style.backgroundColor = '#ffffff';

    const files = Array.from(e.dataTransfer.files);

    if (files.length === 0) {
      return;
    }

    // Add rows for each dropped file
    files.forEach((file, index) => {
      const row = document.createElement('tr');
      row.className = 'govuk-table__row uploading-row';
      row.dataset.file = file.name;

      row.innerHTML = `
        <td class="govuk-table__cell">
          ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)
        </td>
        <td class="govuk-table__cell">
          Uploading: <span class="progress-percent">0%</span>
        </td>
        <td class="govuk-table__cell">
          <a href="#" class="govuk-link">Cancel</a>
        </td>
      `;

      tableBody.appendChild(row);

      // Trigger animation for this row
      animateUpload(row, index);
    });
  });

  // Function to animate upload progress
  function animateUpload(row, index) {
    let percent = 0;
    const progressEl = row.querySelector('.progress-percent');

    const interval = setInterval(() => {
      percent++;
      progressEl.textContent = percent + '%';

      if (percent >= 100) {
        clearInterval(interval);

        const fileName = row.dataset.file;

        row.innerHTML = `
          <td class="govuk-table__cell">
            <a href="#" class="govuk-link">${fileName}</a>
          </td>
          <td class="govuk-table__cell">
            <strong class="govuk-tag govuk-tag--green">Uploaded</strong>
          </td>
          <td class="govuk-table__cell">
            <a href="#" class="govuk-link remove-link">Remove</a>
          </td>
        `;
      }
    }, 40 + index * 20);
  }

  // Handle Cancel / Remove clicks
  document.addEventListener('click', function (e) {
    const link = e.target.closest('.govuk-link');

    if (!link) return;

    const text = link.textContent.trim();

    if (text === 'Cancel' || text === 'Remove') {
      e.preventDefault();

      const row = link.closest('.govuk-table__row');

      if (row) {
        row.remove();
      }
    }
  });
</script>


{% endblock %}
