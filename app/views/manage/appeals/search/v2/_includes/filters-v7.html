<style>
  /* ===== Robustly hide hidden elements ===== */
  [hidden] {
    display: none !important;
  }

  /* ===== Filters header (GDS-style section header) ===== */
  .filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 8px;
    margin-top: 20px;
    margin-bottom: 12px;
    border-bottom: 1px solid #b1b4b6;
  }

  /* ===== Filter panel styles ===== */
  .filters-container {
    background: #ffffff;
    border: 1px solid #b1b4b6;
    border-radius: 4px;
    padding: 16px;
  }

  .filters-inner {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
  }

  @media (min-width: 40.0625em) {
    .filters-inner {
      grid-template-columns: 1fr 1fr;
    }
  }

  /* ===== Applied filters box ===== */
  .app-applied-filters {
    background: #f3f2f1;
    border: 1px solid #b1b4b6;
    border-radius: 4px;
    padding: 12px 16px;
    margin: 16px 0 20px 0;
  }

  .app-applied-filters__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
  }

  .app-applied-filters__chips {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }

  /* ===== Chips ===== */
  .app-chip {
    display: inline-flex;
    align-items: center;
    background: #ffffff;
    border: 1px solid #b1b4b6;
    padding: 6px 12px;
    border-radius: 5px;
    font-size: 16px;
    line-height: 1.2;
  }

  .app-chip__remove {
    background: none;
    border: none;
    font-size: 18px;
    margin-left: 8px;
    cursor: pointer;
  }

  .app-button--no-margin {
    margin-bottom: 8px !important;
  }

  .filters-actions {
  grid-column: 1 / -1;   /* span both grid columns */
  display: flex;
}


</style>



<!-- ====================== FILTERS HEADER ====================== -->
<button type="button" class="govuk-button govuk-button--secondary app-button--no-margin" id="toggle-filters"
  aria-expanded="false" aria-controls="filters-panel">
  Show filter options
</button>



<!-- ====================== FILTER OPTIONS PANEL ====================== -->
<div id="filters-panel" hidden class="filters-container govuk-!-margin-top-2">
  <form id="filters-form" method="get" class="filters-inner">

    <!-- Appeal Type -->
    <fieldset class="govuk-fieldset">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
        Appeal type
      </legend>

      <div class="govuk-checkboxes govuk-checkboxes--small">

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="type-advert" name="type" value="Advertisement" type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="type-advert">Advertisement</label>
        </div>

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="type-cas" name="type" value="Commercial planning (CAS)"
            type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="type-cas">Commercial planning (CAS)</label>
        </div>

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="type-enforcement" name="type" value="Enforcement" type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="type-enforcement">Enforcement</label>
        </div>

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="type-householder" name="type" value="Householder" type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="type-householder">Householder</label>
        </div>

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="type-planning" name="type" value="Planning" type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="type-planning">Planning</label>
        </div>

      </div>
    </fieldset>


    <!-- Action Required -->
    <fieldset class="govuk-fieldset">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">Action required</legend>

      <div class="govuk-checkboxes govuk-checkboxes--small">

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="action-questionnaire" name="action" value="Questionnaire"
            type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="action-questionnaire">Questionnaire</label>
        </div>

        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="action-statement" name="action" value="Statement" type="checkbox">
          <label class="govuk-label govuk-checkboxes__label" for="action-statement">Statement</label>
        </div>

      </div>
    </fieldset>


    <div class="filters-actions">
      {{ govukButton({
        text: "Apply filters",
        classes: "govuk-!-margin-top-2 govuk-!-margin-bottom-0",
        attributes: { id: "apply-filters-btn" }
      }) }}
    </div>

  </form>
</div>



<!-- ====================== APPLIED FILTERS (BELOW PANEL) ====================== -->
<div class="app-applied-filters" id="applied-filters-box" aria-live="polite" hidden>
  <div class="app-applied-filters__header">
    <h3 class="govuk-heading-s govuk-!-margin-bottom-2">Applied filters</h3>

    <a href="#" id="clear-filters" class="govuk-link govuk-link--no-visited-state" role="button">
      Clear all
    </a>
  </div>

  <div id="filter-chips" class="app-applied-filters__chips"></div>
</div>



<!-- ====================== JAVASCRIPT ====================== -->
<script>
  (function () {

    const toggleButton = document.getElementById('toggle-filters');
    const panel = document.getElementById('filters-panel');
    const form = document.getElementById('filters-form');
    const chipsContainer = document.getElementById('filter-chips');
    const appliedBox = document.getElementById('applied-filters-box');
    const clearBtn = document.getElementById('clear-filters');

    /* ===== Toggle panel ===== */
    toggleButton.addEventListener('click', () => {
      const open = toggleButton.getAttribute('aria-expanded') === 'true';
      toggleButton.setAttribute('aria-expanded', String(!open));
      toggleButton.textContent = open ? 'Show filter options' : 'Hide filter options';
      panel.hidden = open;
    });

    /* ===== Build chips ===== */
    function renderChipsFrom(checkedInputs) {
      chipsContainer.innerHTML = '';

      if (!checkedInputs.length) {
        appliedBox.hidden = true;
        return;
      }

      appliedBox.hidden = false;

      checkedInputs.forEach((input) => {
        const chip = document.createElement('div');
        chip.className = 'app-chip';
        chip.innerHTML = `
        <span>${input.value}</span>
        <button type="button" class="app-chip__remove" data-target="${input.id}">
          âœ•
        </button>
      `;
        chipsContainer.appendChild(chip);
      });
    }

    /* ===== Apply filters ===== */
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const checked = form.querySelectorAll('input[type=checkbox]:checked');
      renderChipsFrom(checked);
    });

    /* ===== Remove chip ===== */
    chipsContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('app-chip__remove')) {
        const id = e.target.dataset.target;
        const input = document.getElementById(id);
        if (input) input.checked = false;

        const checked = form.querySelectorAll('input[type=checkbox]:checked');
        renderChipsFrom(checked);
      }
    });

    /* ===== Clear all ===== */
    clearBtn.addEventListener('click', (e) => {
      e.preventDefault();
      form.reset();
      renderChipsFrom([]);
    });

  })();
</script>