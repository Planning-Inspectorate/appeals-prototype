<li>
  {# Calculate status for Submit section #}
  {# Check if Prepare section is complete #}
  {% set prepareRequired = [
    data['application-name'],
    data['telephoneNumber'],
    data['address-line-1'],
    data['green-belt'],
    data['health-and-safety'],
    data['appNumber'],
    data['application-date-day'],
    data['moreDetail'],
    data['existing-or-proposed'],
    data['decide-appeal'],
    data['other-appeals-radio']
  ] %}
  {% set prepareOptional = [] %}
  {% if data['application-name'] == 'No' %}
    {% set prepareOptional = prepareOptional.concat([data['appellant-first-name']]) %}
  {% endif %}
  {% if data['existing-or-proposed'] and data['existing-or-proposed'] != 'Existing development' %}
    {% set prepareOptional = prepareOptional.concat([data['description-detail'], data['description-development-correct']]) %}
  {% endif %}
  {% if data['decide-appeal'] == 'Hearing' %}
    {% set prepareOptional = prepareOptional.concat([data['preferHearing']]) %}
  {% endif %}
  {% if data['decide-appeal'] == 'Inquiry' %}
    {% set prepareOptional = prepareOptional.concat([data['preferInquiry'], data['width5'], data['how-many-witnesses']]) %}
  {% endif %}
  {% if data['other-appeals-radio'] == 'Yes' %}
    {% set prepareOptional = prepareOptional.concat([data['other-appeal-reference']]) %}
  {% endif %}
  {% set prepareAll = prepareRequired.concat(prepareOptional) %}
  {% set prepareAnswered = prepareAll | reject("equalto", undefined) | reject("equalto", "") | list %}
  {% set prepareComplete = (prepareAnswered.length == prepareAll.length and prepareAll.length > 0) %}
  
  {# Check if Upload section is complete #}
  {% set uploadRequired = [
    data['application-form'],
    data['planning-obligation-check'],
    data['appeal-statement'],
    data['costs-check'],
    data['new-plans-drawings-check'],
    data['other-new-documents-check']
  ] %}
  {% set uploadOptional = [] %}
  {% if data['description-development-correct'] and data['description-development-correct'].startsWith('Yes') %}
    {% set uploadOptional = uploadOptional.concat([data['description-change-agreement']]) %}
  {% endif %}
  {% if data['granted-or-refused'] == 'Granted with conditions' or data['granted-or-refused'] == 'Refused' %}
    {% set uploadOptional = uploadOptional.concat([data['decision-letter']]) %}
  {% endif %}
  {% if data['planning-obligation-check'] == 'Yes' %}
    {% set uploadOptional = uploadOptional.concat([data['planning-obligation-status'], data['planning-obligation']]) %}
  {% endif %}
  {% if data['decide-appeal'] == 'Hearing' or data['decide-appeal'] == 'Inquiry' %}
    {% set uploadOptional = uploadOptional.concat([data['draft-statement-common-ground']]) %}
  {% endif %}
  {% if data['costs-check'] == 'Yes' %}
    {% set uploadOptional = uploadOptional.concat([data['costs-upload']]) %}
  {% endif %}
  {% if data['new-plans-drawings-check'] == 'Yes' %}
    {% set uploadOptional = uploadOptional.concat([data['upload-new-plans-drawings']]) %}
  {% endif %}
  {% if data['other-new-documents-check'] == 'Yes' %}
    {% set uploadOptional = uploadOptional.concat([data['upload-other-new-documents']]) %}
  {% endif %}
  {% set uploadAll = uploadRequired.concat(uploadOptional) %}
  {% set uploadAnswered = uploadAll | reject("equalto", undefined) | reject("equalto", "") | list %}
  {% set uploadComplete = (uploadAnswered.length == uploadAll.length and uploadAll.length > 0) %}
  
  <h2 class="app-task-list__section">
    <span class="app-task-list__section-number">3. </span>
    Submit your appeal
    {% if data['declaration'] %}
      {{ govukTag({
        text: "Completed",
        classes: "govuk-tag"
      }) }}
    {% elif prepareComplete and uploadComplete %}
      {{ govukTag({
        text: "Ready to submit",
        classes: "govuk-tag govuk-tag--blue"
      }) }}
    {% else %}
      {{ govukTag({
        text: "Cannot start yet",
        classes: "govuk-tag govuk-tag--grey"
      }) }}
    {% endif %}
  </h2>

  {{ govukTable({
    firstCellIsHeader: true,
    head: [],
    rows: [
      [
        { text: "Accept declaration and submit", classes: "govuk-!-font-weight-bold govuk-!-width-one-third" },
        { text: "", classes: "govuk-!-width-one-half" },
        { html: '<a href="../upload-documents/declaration" class="govuk-link">Continue</a>' if (prepareComplete and uploadComplete) else '', classes: "govuk-!-text-align-right" }
      ]
    ]
  }) }}
</li>
